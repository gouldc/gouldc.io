<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Stata Coding Guide - Julian Reif</title>
<meta name="description" content="">


  <meta name="author" content="Julian Reif">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Julian Reif">
<meta property="og:title" content="Stata Coding Guide">
<meta property="og:url" content="/guide/">


  <meta property="og:description" content="">












<link rel="canonical" href="/guide/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Julian Reif Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="shortcut icon" href="../../assets/images/favicon.ico" />

<link rel="stylesheet" href="/assets/css/syntax.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YQG0V8L75K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YQG0V8L75K');
</script>
<!-- end custom head snippets -->
  </head>

  <body class="layout--single wide" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Julian Reif
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/"
                
                
              >Home</a>
            </li><li class="masthead__menu-item">
              <a
                href="/cv/reif.cv.pdf"
                
                
              >CV</a>
            </li><li class="masthead__menu-item">
              <a
                href="/research/"
                
                
              >Research</a>
            </li><li class="masthead__menu-item">
              <a
                href="/software/"
                
                
              >Software</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      <nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      
      
        <li>
          
            <a href="/guide/#setting-up-the-environment"><span class="nav__sub-title">Setting up the environment</span></a>
          

          
          <ul>
            
              <li><a href="/guide/#dropbox">Dropbox</a></li>
            
              <li><a href="/guide/#stata-profile">Stata profile</a></li>
            
              <li><a href="/guide/#r-profile">R profile</a></li>
            
              <li><a href="/guide/#version-control-systems">Version control systems</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <a href="/guide/#organizing-the-project"><span class="nav__sub-title">Organizing the project</span></a>
          

          
          <ul>
            
              <li><a href="/guide/#folder-structure">Folder structure</a></li>
            
              <li><a href="/guide/#programs">Programs</a></li>
            
              <li><a href="/guide/#libraries">Libraries</a></li>
            
              <li><a href="/guide/#stata-plugins-advanced">Stata plugins (advanced)</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <a href="/guide/#automating-tables"><span class="nav__sub-title">Automating tables</span></a>
          

          
          <ul>
            
              <li><a href="/guide/#regsave">regsave</a></li>
            
              <li><a href="/guide/#texsave">texsave</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <a href="/guide/#submission-checklist"><span class="nav__sub-title">Submission checklist</span></a>
          

          
        </li>
      
        <li>
          
            <a href="/guide/#stata-coding-tips"><span class="nav__sub-title">Stata coding tips</span></a>
          

          
        </li>
      
        <li>
          
            <a href="/guide/#other-helpful-links"><span class="nav__sub-title">Other helpful links</span></a>
          

          
        </li>
      
        <li>
          
            <a href="/guide/#acknowledgments"><span class="nav__sub-title">Acknowledgments</span></a>
          

          
        </li>
      
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Stata Coding Guide">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="/guide/" itemprop="url">Stata Coding Guide
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Empirical research in economics has grown in importance due to advancements in computing power and the increased availability of rich administrative datasets. Researchers now commonly estimate regressions using millions of observations from multiple data sources. Often, research teams consist of members from different universities, collaborating on complex projects. Analyses involving confidential data is typically performed remotely, often on non-networked computers at research data centers. Cutting-edge analyses may require writing thousands or even millions of lines of code in multiple languages.</p>

<p>These recent developments introduce increased complexity and the potential for non-transparent errors. Peer review rarely evaluates code, even though code often represents the bulk of the work. Studies suggest that the results from many published papers <a href="/research/reif.igpa.2021.reproducibility.pdf">cannot be reproduced</a> from the code and data provided by the original authors. To address this issue, the American Economic Association (AEA) has implemented a new <a href="https://www.aeaweb.org/journals/policies/data-code">data and code availability policy</a> to establish professional standards for coding and documentation. Unfortunately, most researchers, myself included, received little or no training in project organization, coding, or documentation.</p>

<p>This guide outlines how to set up a robust coding environment and write a “push-button” analysis in Stata. Its purpose is to help researchers:</p>
<ol>
  <li>Minimize coding errors</li>
  <li>Automate the creation of tables and figures</li>
  <li>Integrate Stata code with supporting R analyses</li>
  <li>Produce a replication package with the following features:
    <ul>
      <li>Compliance with the AEA’s <a href="https://www.aeaweb.org/journals/policies/data-code">data and code availability policy</a></li>
      <li>Cross-platform compatibility (Mac, Windows, Unix)</li>
      <li>Functionality on a non-networked computer (i.e., no need to download add-ons)</li>
    </ul>
  </li>
</ol>

<p>The guide includes an AEA-compliant <a href="https://github.com/reifjulian/my-project">sample replication package</a> that you can use as a template. Try it out and see how easy (or not!) it is to reproduce the example analysis. If you encounter any difficulties, please let me know.</p>

<h1 id="setting-up-the-environment">Setting up the environment</h1>

<p>I often work on several projects simultaneously, accessing them from multiple computers (laptop, home, work) and sharing them with multiple coauthors. Using multiple environments makes it challenging to define the pathname (location) of a folder. For instance, a project’s location may be <strong>/Users/jreif/my-project</strong> on one computer and <strong>/Users/coauthor/my-project</strong> on another. Manually changing this pathname every time a different person or computer runs the code is cumbersome, especially for large projects with many lines of code. Additionally, if you install an add-on on your local computer, it will not be available to your collaborators.</p>

<p>Below I describe how I set up my working environment to address these challenges. Note that users are NOT required to do this in order to run my published code. However, setting up your environment as I do will make it easier to develop your analysis in environments with multiple computers and coauthors. My focus is on a setting where code is written in Stata and R. Although Stata provides native support for running <a href="https://blog.stata.com/2020/08/18/stata-python-integration-part-1-setting-up-stata-to-use-python/">Python code</a>, I do not discuss that here.</p>

<h2 id="dropbox">Dropbox</h2>

<p>I use Dropbox to sync my projects across different environments. Dropbox offers several appealing features. It creates backups across multiple computers and the Dropbox server, and in my experience has fewer bugs compared to alternatives like Box. Dropbox makes it easy to share files with coauthors. All files stored on Dropbox have the same relative paths, which simplifies pathnames when writing scripts (more on this below). <a href="#version-control-systems">Version control systems</a> can be used as an alternative or complement to Dropbox.</p>

<h2 id="stata-profile">Stata profile</h2>

<p>Stata automatically runs the script <strong>profile.do</strong> upon launch (if found).</p>

<p><img src="../assets/guide/stata_profile.PNG" width="100%" title="Stata profile" /></p>

<p><strong>profile.do</strong> must be stored in one of the paths searched by Stata. Type <code class="language-plaintext highlighter-rouge">adopath</code> at the Stata prompt to view a list of the eligible paths for your particular computer. On my mac, I store this file in <strong>/Users/jreif/Documents/Stata/ado/personal/profile.do</strong>. On my PC, I store it in <strong>C:/ado/personal/profile.do</strong>.</p>

<p>Here are the contents of the Stata profile stored on my PC:</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">* Settings specific to local environment</span>
<span class="kt">global</span><span class="w"> </span><span class="n">DROPBOX</span><span class="w"> </span><span class="s2">"C:/Users/jreif/Dropbox"</span>

<span class="c1">* Run file containing settings common to all environments</span>
<span class="k">run</span><span class="w"> </span><span class="s2">"$DROPBOX/stata_profile.do"</span>
</code></pre></div></div>

<p>This file contains settings specific to my PC, namely the location of my Dropbox folder. The Stata profile stored on my mac is identical except that it defines a different location for <code class="language-plaintext highlighter-rouge">DROPBOX</code>. While I could define the locations of all my projects directly in <strong>profile.do</strong>, I instead store those definitions, along with any other settings common across my computers, on Dropbox in a script called <strong>stata_profile.do</strong>. I then call that script from <strong>profile.do</strong>.</p>

<p>Here are the contents of an example <strong>stata_profile.do</strong> stored on Dropbox:</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">set</span><span class="w"> </span><span class="n">varabbrev</span><span class="w"> </span><span class="n">off</span>
<span class="k">set</span><span class="w"> </span><span class="n">reshape_favor</span><span class="w"> </span><span class="n">speed</span>
<span class="k">set</span><span class="w"> </span><span class="n">doeditbackup</span><span class="w"> </span><span class="n">off</span>
<span class="kt">global</span><span class="w"> </span><span class="n">MyProject</span><span class="w"> </span><span class="s2">"$DROPBOX/my-project/analysis"</span>
</code></pre></div></div>

<p>The first line, <code class="language-plaintext highlighter-rouge">set varabbrev off</code>, is a command I want executed every time I open Stata on all my computers, for reasons <a href="#stata-coding-tips">I explain below</a>. The second line speeds up reshape (requires Stata 18 or later) and the third line instructs Stata not to create do-file editor backup (*.stswp) files. The last line defines the location of the analysis for <a href="https://github.com/reifjulian/my-project">MyProject</a>, which I stored on Dropbox. In practice my Stata profile defines a large number of globals, one for every project I am working on. Whenever I start a new project, I define a new global for it and add it to <strong>stata_profile.do</strong>. Because all my computers are synced to Dropbox, I only have to create a new global once per project.</p>

<h2 id="r-profile">R profile</h2>

<p>I write most of my code in Stata, including C++ plugins such as <a href="https://github.com/reifjulian/strgroup">strgroup</a>. On occasion, I will use an R function that is not available in Stata, such as <a href="https://xgboost.readthedocs.io/en/latest/">XGBoost</a>. In these cases I like to create an R environment that aligns with my Stata environment.</p>

<p>Similar to Stata, R automatically runs <strong>.Rprofile</strong> upon launch (if found). This file is typically stored in your home directory, whose location you can find by typing <code class="language-plaintext highlighter-rouge">normalizePath(path.expand("~"),winslash="/")</code> at the R prompt.</p>

<p class="notice--info"><strong>R Tip:</strong> Additional details regarding how R sets up its environment at startup are available in this <a href="https://web.archive.org/web/20190907041505/https://csgillespie.github.io/efficientR/3-3-r-startup.html#r-startup">R programming guide</a>.</p>

<p>Here are the contents of my R profile, stored in <strong>C:/Users/jreif/Documents/.Rprofile</strong>:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cat</span><span class="p">(</span><span class="s2">"Running .Rprofile...\n\n"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Settings specific to local environment</span><span class="w">
</span><span class="n">Sys.setenv</span><span class="p">(</span><span class="n">DROPBOX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:/Users/jreif/Dropbox"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run file containing settings common to all environments</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">Sys.getenv</span><span class="p">(</span><span class="s2">"DROPBOX"</span><span class="p">),</span><span class="w"> </span><span class="s2">"R_profile.R"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>As with my Stata profile, my R profile in turn runs a second script located at the top level of my Dropbox directory. This file, <strong>R_profile.R</strong>, stores R settings common across all my computers, such as the paths for all my projects. Here is an example for the MyProject analysis:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Sys.setenv</span><span class="p">(</span><span class="n">MyProject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">Sys.getenv</span><span class="p">(</span><span class="s2">"DROPBOX"</span><span class="p">),</span><span class="w"> </span><span class="s2">"my-project/analysis"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<h2 id="version-control-systems">Version control systems</h2>

<p>Version control systems like Git and SVN are essential for large software development collaborations. I myself use GitHub when developing my <a href="https://github.com/reifjulian/">software packages</a>. However, I generally find these systems unnecessary for academic analyses, which typically involve a small number of coauthors and conclude after publication. If you’re interested in learning more about version control, I recommend checking out <a href="https://raw.githack.com/uo-ec607/lectures/master/02-git/02-Git.html#1">Grant McDermott’s Git slides</a>.</p>

<h1 id="organizing-the-project">Organizing the project</h1>

<h2 id="folder-structure">Folder structure</h2>

<p>A project includes lots of different parts: the analysis, the manuscript, related literature, grant proposals, etc. The analysis, which includes both code and data, should be kept in a distinct location. Keeping the analysis separate makes it easier to create a standalone replication package when the project is complete.
A typical analysis starts with raw data (e.g., a dataset downloaded from the web). Scripts process these data and then run the analysis. Scripts and data should be stored in separate folders. The core directory structure for my analyses looks like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
└── analysis/
    ├── data/
    ├── scripts/
        ├── 1_process_raw_data.do
        └── 2_...
    └── run.do		
</code></pre></div></div>

<p>The master script, <strong>run.do</strong>, executes the entire analysis. Running this script creates all necessary additional folders, intermediate files, and results:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
└── analysis/
    ├── data/
    ├── processed/
    ├── results/
        ├── figures/
        └── tables/
    ├── scripts/
        ├── 1_process_raw_data.do
        └── 2_...
    └── run.do		
</code></pre></div></div>

<p>At any time, you can delete <strong>processed/</strong> and <strong>results/</strong>, keeping only <strong>data/</strong> and <strong>scripts/</strong>, and then rerun your analysis from scratch. When the project is complete, a copy of <strong>analysis/</strong> serves as a standalone replication package.</p>

<p>The folder <strong>scripts/</strong> includes all scripts and libraries (add-on packages) required to run the analysis. <strong>data/</strong> includes raw (input) data and is read-only. Thus, my scripts write files only to <strong>processed/</strong> or <strong>results/</strong>.</p>

<p>The folder <strong>results/</strong> contains all final output, including tables and figures. These can be linked to a LaTeX document on <a href="https://www.overleaf.com">Overleaf</a> or stored in an adjacent folder. For example, <a href="https://github.com/reifjulian/my-project">MyProject</a> has the following folder structure:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── analysis/
    ├── data/
    ├── processed/
    ├── results/
        ├── figures/
        └── tables/
    ├── scripts/
        ├── 1_process_raw_data.do
        └── 2_...
    └── run.do
└── paper/
    ├── manuscript.tex
    ├── figures/
    └── tables/
</code></pre></div></div>

<p>To update the MyProject manuscript, copy <strong>analysis/results/figures/</strong> and <strong>analysis/results/tables/</strong> to <strong>paper/</strong>, which contains manuscript files. Additional documents such as literature references can be stored in <strong>paper/</strong> or in a separate, standalone folder at the top the project directory.</p>

<p class="notice--info"><strong>LaTeX Tip:</strong> Looking for a clean LaTeX template for your manuscript? Feel free to use my <a href="https://raw.githubusercontent.com/reifjulian/my-project/master/paper/my_paper.tex">sample manuscript</a>.</p>

<h2 id="programs">Programs</h2>

<p>Programs (AKA functions, subroutines) are additional pieces of code called by your scripts. These might be do-files, ado-files, or scripts written in another programming language such as R. An introduction to ado-files is available on the <a href="https://blog.stata.com/2015/11/10/programming-an-estimation-command-in-stata-a-first-ado-command">Stata blog</a>. Because programs are not called directly by the master script, <strong>run.do</strong>, I usually store them in the subdirectory <strong>scripts/programs/</strong>. This reduces clutter in large projects with many scripts and many subroutines.</p>

<h2 id="libraries">Libraries</h2>

<p>My code frequently employs user-written (add-on) Stata commands, such as <a href="https://github.com/reifjulian/regsave">regsave</a> or <a href="http://scorreia.com/software/reghdfe/install.html">reghdfe</a>. To ensure replication, it is <em>very important</em> to include copies of these programs with your code:</p>
<ol>
  <li>A user can’t run your code without it.</li>
  <li>These commands are updated over time, causing your code to break or produce different output.</li>
</ol>

<p>Many people do not realize how code updates can inhibit replication. Here is an example. Imagine you conduct a Stata analysis using a new, user-written estimation command called, say, <code class="language-plaintext highlighter-rouge">regols</code>. You publish your paper and include your replication code, but you do not include the code for <code class="language-plaintext highlighter-rouge">regols</code>. Ten years later a researcher tries to replicate your analysis. The code fails because she has not installed <code class="language-plaintext highlighter-rouge">regols</code>. She opens Stata and types <code class="language-plaintext highlighter-rouge">ssc install regols</code>, which installs the latest version of the command. However, in the intervening ten years, the author of <code class="language-plaintext highlighter-rouge">regols</code> fixed a bug in the calculation of standard errors. When the researcher runs your code with her updated version of <code class="language-plaintext highlighter-rouge">regols</code>, she finds that your estimates are no longer statistically significant. The researcher is unsure whether this discrepancy is due to an incorrect dataset, a mistake in the analysis code, an error that arose when copy/pasting your output into your publication, or… Whatever the reason, she cannot replicate your published results and must decide how to interpret this failure.</p>

<p>Stata takes version control <a href="https://www.stata.com/features/integrated-version-control/">seriously</a>. You should always include a <code class="language-plaintext highlighter-rouge">version</code> statement in your <a href="https://github.com/reifjulian/my-project/blob/master/analysis/run.do">master script</a>. Writing <code class="language-plaintext highlighter-rouge">version 15</code> instructs all future versions of Stata to execute its functions the same way Stata 15 did. However, most add-on (user-written) packages are not version controlled.  To address this, I include a script called <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/_install_stata_packages.do">_install_stata_packages.do</a> in all my working projects. This script installs copies of any user-written packages used by the project into a subdirectory of the project folder: <strong>analysis/scripts/libraries/stata</strong>. Rerunning this script will install updated versions of these add-ons as desired. I delete this script when my project is ready to be published, which effectively locks down the code for these user-written packages and ensures I can replicate my Stata analysis forever into the future. In addition, including these user-written packages ensures my code will run on a non-networked computer that does not have access to the internet.</p>

<p>Note: Stata automatically creates a record of the packages you installed in <strong>analysis/scripts/libraries/stata/stata.trk</strong>. This text file can be <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/libraries/stata/stata.trk">accessed manually</a>, or viewed in Stata using the <code class="language-plaintext highlighter-rouge">ado describe</code> command. For example, run the following code to view the source URLs and installation dates for the Stata packages from my example project: <code class="language-plaintext highlighter-rouge">ado describe, from("https://julianreif.com/my-project/analysis/scripts/libraries/stata")</code>. This record will automatically be included as part of your replication package.</p>

<div class="notice--info">
  <p><strong>Stata tip:</strong> By default, Stata searches for add-on packages in multiple folders. I recommend disabling this behavior when working on a long-term project, which will ensure that Stata looks for add-ons only in your local project folder when running your project code. The following code in my <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/programs/_config.do">configuration script</a> removes these non-project folders from the search path:</p>
  <div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">tokenize</span><span class="w"> </span><span class="s2">`"$S_ADO"'</span><span class="p">,</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span>
<span class="kr">while</span><span class="w"> </span><span class="s2">`"`1'"'</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="s2">`"`1'"'</span><span class="o">!=</span><span class="s2">"BASE"</span><span class="w"> </span><span class="n">cap</span><span class="w"> </span><span class="n">adopath</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="s2">`"`1'"'</span>
<span class="k">  macro</span><span class="w"> </span><span class="n">shift</span>
<span class="p">}</span>
<span class="k">adopath</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="s2">"`ProjectDir'/scripts/libraries/stata"</span>
</code></pre></div>  </div>
  <p>Note: these changes apply only to the active Stata session. Closing and reopening Stata will revert to the default of searching in multiple folders.</p>
</div>

<p>I am unaware of a version control statement for R, which means the behavior of its built-in functions may <a href="https://f.briatte.org/r/change-in-sample-function-r-3-6-0">depend</a> on what version of R you are running. As a second-best solution, my <a href="https://github.com/reifjulian/my-project/blob/master/analysis/run.do">master script</a> uses the Stata add-on command <a href="https://github.com/reifjulian/rscript">rscript</a> to check whether the user (1) is running a sufficiently recent version of R; and (2) has installed R libraries required by my analysis, such as <code class="language-plaintext highlighter-rouge">tidyverse</code>. As with Stata, it is possible to install these add-on packages into your project subdirectory. In practice, doing this in R creates headaches. Add-on packages such as <code class="language-plaintext highlighter-rouge">tidyverse</code> are very large (hundreds of megabytes) and–if you want to ensure cross-platform replicability–need to be installed separately for Mac, Unix, and Windows. Doing this for my sample replication project would increase that project’s file size by nearly a gigabyte! I therefore again settled for a second-best solution and instead require the user to install these packages themselves. As described in my sample project <a href="https://github.com/reifjulian/my-project/blob/master/analysis/README.pdf">README</a>, the user can install these packages in three different ways:</p>
<ol>
  <li>Manually by typing, e.g., <code class="language-plaintext highlighter-rouge">install.packages(“tidyverse”)</code> at the R prompt</li>
  <li>Automatically by opening R and running <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/programs/_install_R_packages.R">_install_R_packages.R</a></li>
  <li>Automatically by uncommenting line 44 of <a href="https://github.com/reifjulian/my-project/blob/master/analysis/run.do">run.do</a></li>
</ol>

<p>If you don’t mind using up extra disk space and want to ensure reproducibility, you can install your R packages in the project subdirectory. See the commented out code in <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/programs/_install_R_packages.R">_install_R_packages.R</a> for an example. Following this example will result in a folder structure that looks like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
└── analysis/
    ├── data/
    └── scripts/
        ├── libraries/
    	    ├── R/
                ├── linux/
                ├── osx/			
                └── windows/				
    	    └── stata/
        ├── programs/
        ├── 1_process_raw_data.do
        └── 2_...
    └── run.do		
</code></pre></div></div>
<p>Other alternatives–used frequently by serious users of R–include <a href="https://rstudio.github.io/packrat/">packrat</a>, <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a>, and <a href="https://groundhogr.com/">groundhog</a>.</p>

<h3 id="stata-plugins-advanced">Stata plugins (advanced)</h3>

<p>Most Stata add-ons are written in Stata or Mata, which are cross-platform languages that run on any computer with a copy of Stata. A small number of Stata add-ons are written in C/C++ and must be compiled to a plugin (AKA dynamically linked library, or DLL) that is specific to your computer’s architecture. Mauricio Bravo provides a nice <a href="https://mcaceresb.github.io/stata/plugins/2017/02/15/writing-stata-plugins-example.html">example</a> of the benefits of plugins.</p>

<p>If you write C/C++ code for Stata, I encourage you to compile it for multiple platforms and include all platform-specific plugins as part of your replication package. See <a href="https://github.com/mcaceresb/stata-gtools">gtools</a> and <a href="https://github.com/reifjulian/strgroup">strgroup</a> for examples of how to write a program that autodetects which plugin to call based on your computer’s architecture.</p>

<h1 id="automating-tables">Automating tables</h1>

<p>Automating your tables and figures facilitates data updates and minimizes mistakes that can arise when transferring results from Stata to your manuscript. Automating figures is easy using Stata’s <code class="language-plaintext highlighter-rouge">graph export</code> command. Automating tables usually requires customized add-ons.</p>

<p>There are many ways to automate tables in Stata. Below I present my preferred method, which uses Stata add-ons I developed for prior projects. This method is targeted at people who use LaTeX and desire flexible control over their table formatting; users interested only in learning about how to save regression results can read about <code class="language-plaintext highlighter-rouge">regsave</code> and skip the part about <code class="language-plaintext highlighter-rouge">texsave</code>. For examples of the kinds of tables you can automate in Stata using my add-ons, see my papers on <a href="https://www.nber.org/workplacewellness/s/IL_Wellness_Study_1.pdf">workplace wellness</a> or <a href="https://julianreif.com/research/reif.aeri.2021.driving.pdf">teenage driving</a>. Popular alternatives to my add-ons include <a href="http://repec.sowi.unibe.ch/stata/estout/index.html">estout</a> and <a href="https://www.princeton.edu/~otorres/Outreg2.pdf">outreg2</a>.</p>

<p>My method separates table automation into two distinct steps. The first step uses <a href="https://github.com/reifjulian/regsave">regsave</a> to save regression output to a file. The second step uses <a href="https://github.com/reifjulian/texsave">texsave</a> to save the output in LaTeX format. In-between these two steps you can use Stata’s built-in data manipulation commands to organize your table however you like.</p>

<h2 id="regsave">regsave</h2>

<p><code class="language-plaintext highlighter-rouge">regsave</code> is a Stata add-on that stores regression results. To install the latest version, run the following at your Stata prompt:</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">net</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">regsave</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/reifjulian/regsave/master"</span><span class="p">)</span><span class="w"> </span><span class="n">replace</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">regsave</code> <a href="https://github.com/reifjulian/regsave">online documentation</a> provides a full tutorial. Below, I demonstrate it using examples from my <a href="https://github.com/reifjulian/my-project">sample replication package</a>. This code is a good example of how I use it in most of my analyses.</p>

<p>We begin by running the following code from the script <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/3_regressions.do">3_regressions.do</a>:</p>
<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">tempfile</span><span class="w"> </span><span class="n">results</span>
<span class="k">use</span><span class="w"> </span><span class="s2">"$MyProject/processed/auto.dta"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>

<span class="kt">local</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">replace</span>
<span class="kr">foreach</span><span class="w"> </span><span class="n">rhs</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s2">"mpg"</span><span class="w"> </span><span class="s2">"mpg weight"</span><span class="w"> </span><span class="p">{</span>
<span class="c1">	
  * Domestic cars</span>
<span class="k">  reg</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="s2">`rhs'</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">foreign</span><span class="o">==</span><span class="s2">"Domestic"</span><span class="p">,</span><span class="w"> </span><span class="n">robust</span>
<span class="w">  </span><span class="n">regsave</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="s2">"`results'"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">autoid</span><span class="w"> </span><span class="n">addlabel</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span><span class="s2">"`rhs'"</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">Domestic</span><span class="p">)</span><span class="w"> </span><span class="s2">`replace'</span><span class="w"> </span>
<span class="w">  </span><span class="kt">local</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">append</span>
<span class="c1">	
  * Foreign cars</span>
<span class="k">  reg</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="s2">`rhs'</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">foreign</span><span class="o">==</span><span class="s2">"Foreign"</span><span class="p">,</span><span class="w"> </span><span class="n">robust</span>
<span class="w">  </span><span class="n">regsave</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="s2">"`results'"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">autoid</span><span class="w"> </span><span class="n">addlabel</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span><span class="s2">"`rhs'"</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="s2">"Foreign"</span><span class="p">)</span><span class="w"> </span><span class="n">append</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This code estimates four different regressions and saves the results to a tempfile, <code class="language-plaintext highlighter-rouge">results</code>. Let’s open that file and look at the contents.</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span><span class="w"> </span><span class="s2">"`results'"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
<span class="k">list</span>
</code></pre></div></div>

<p><img src="../assets/guide/regsave.PNG" width="100%" title="Contents of results tempfile" /></p>

<p>The file contains the regression coefficients, standard errors, t-statistics, p-values, etc. from each of the four regressions. We could have saved more information, such as confidence intervals, by specifying the appropriate option. Type <code class="language-plaintext highlighter-rouge">help regsave</code> to see the full set of options.</p>

<p>This output file can be easily analyzed and manipulated, but it is not ideal for table presentation. We can convert this “long” table to a “wide” table using the <code class="language-plaintext highlighter-rouge">regsave_tbl</code> helper function. Here is the relevant code from <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/4_make_tables_figures.do">4_make_tables_figures.do</a>:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">tempfile</span><span class="w"> </span><span class="n">my_table</span>
<span class="k">use</span><span class="w"> </span><span class="s2">"$MyProject/results/intermediate/my_regressions.dta"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>

<span class="c1">* Merge together the four regressions into one table</span>
<span class="kt">local</span><span class="w"> </span><span class="n">run_no</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="kt">local</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">replace</span>
<span class="kr">foreach</span><span class="w"> </span><span class="n">orig</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s2">"Domestic"</span><span class="w"> </span><span class="s2">"Foreign"</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">foreach</span><span class="w"> </span><span class="n">rhs</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s2">"mpg"</span><span class="w"> </span><span class="s2">"mpg weight"</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span>
<span class="w">    </span><span class="n">regsave_tbl</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="s2">"`my_table'"</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">origin</span><span class="o">==</span><span class="s2">"`orig'"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="o">==</span><span class="s2">"`rhs'"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">col</span><span class="s2">`run_no'</span><span class="p">)</span><span class="w"> </span><span class="n">asterisk</span><span class="p">(</span><span class="m">10</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="n">parentheses</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span><span class="w"> </span><span class="n">sigfig</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="s2">`replace'</span>
<span class="w">		</span>
<span class="w">    </span><span class="kt">local</span><span class="w"> </span><span class="n">run_no</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">`run_no'</span><span class="m">+1</span>
<span class="w">    </span><span class="kt">local</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">append</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This code converts each saved regression to “wide” format and saves it to the tempfile <code class="language-plaintext highlighter-rouge">my_table</code>. Let’s open that tempfile and look at its contents:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span><span class="w"> </span><span class="s2">"`my_table'"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
<span class="k">list</span>
</code></pre></div></div>

<p><img src="../assets/guide/regsave_tbl.PNG" width="100%" title="Contents of my_table tempfile" /></p>

<p>This “wide” format is much more appropriate for a table. Of course, we still need to clean it up. For example, you may not want to report t-statistics or estimates of the constant term. In the next step below we will format the table and use <code class="language-plaintext highlighter-rouge">texsave</code> to output the table into a LaTeX file.</p>

<h2 id="texsave">texsave</h2>

<p><a href="https://github.com/reifjulian/texsave">texsave</a> is a Stata add-on that saves a dataset as a LaTeX text file. To install the latest version, type the following at your Stata prompt:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">net</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">texsave</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/reifjulian/texsave/master"</span><span class="p">)</span><span class="w"> </span><span class="n">replace</span>
</code></pre></div></div>

<p>We first reformat the dataset that was produced using <code class="language-plaintext highlighter-rouge">regsave_tbl</code>:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span><span class="w"> </span><span class="s2">"`my_table'"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
<span class="k">drop</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nf">inlist</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"_id"</span><span class="p">,</span><span class="s2">"rhs"</span><span class="p">,</span><span class="s2">"origin"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">strpos</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"_cons"</span><span class="p">)</span><span class="w"> </span>
<span class="k">drop</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nf">strpos</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"tstat"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">strpos</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"pval"</span><span class="p">)</span>

<span class="c1">* texsave will output these labels as column headers</span>
<span class="k">label</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="s2">"Spec 1"</span>
<span class="k">label</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="n">col2</span><span class="w"> </span><span class="s2">"Spec 2"</span>
<span class="k">label</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="n">col3</span><span class="w"> </span><span class="s2">"Spec 1"</span>
<span class="k">label</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="n">col4</span><span class="w"> </span><span class="s2">"Spec 2"</span>

<span class="c1">* Display R^2 in LaTeX math mode</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\(R^2\)"</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">var</span><span class="o">==</span><span class="s2">"r2"</span>

<span class="c1">* Clean variable names</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">subinstr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"_coef"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nf">strpos</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">"_stderr"</span><span class="p">)</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Miles per gallon"</span><span class="w">     </span><span class="kr">if</span><span class="w"> </span><span class="n">var</span><span class="o">==</span><span class="s2">"mpg"</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Weight (pounds)"</span><span class="w">      </span><span class="kr">if</span><span class="w"> </span><span class="n">var</span><span class="o">==</span><span class="s2">"weight"</span>
<span class="k">replace</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Price (1978 dollars)"</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="n">var</span><span class="o">==</span><span class="s2">"price"</span>

<span class="k">list</span>
</code></pre></div></div>

<p>This code first removes output I didn’t want to report in this table, such as t-statistics and estimates of the constant term. It then labels the four columns of estimates. As we shall see, those Stata labels will serve as column headers in the LaTeX table. The code then rewrites <code class="language-plaintext highlighter-rouge">r2</code> using LaTeX math syntax. The final lines of the code provide more descriptive labels for the regressors. Typing <code class="language-plaintext highlighter-rouge">list</code> shows that our table now looks like this:</p>

<p><img src="../assets/guide/regsave_tbl_clean.PNG" width="100%" title="Cleaned table" /></p>

<p class="notice--info"><strong>LaTeX Tip 1:</strong> You can indicate a math environment in LaTeX using either <code class="language-plaintext highlighter-rouge">\(...\)</code> or <code class="language-plaintext highlighter-rouge">$...$</code> syntax. It’s usually easier to use the <code class="language-plaintext highlighter-rouge">\(...\)</code> syntax because <code class="language-plaintext highlighter-rouge">$</code> marks global macros in Stata.</p>

<p class="notice--info"><strong>LaTeX Tip 2:</strong> If your dataset includes LaTeX code (e.g., <code class="language-plaintext highlighter-rouge">\(R^2\)</code> in table above), instruct texsave not to modify it by specifying the <code class="language-plaintext highlighter-rouge">nofix</code> option. (See code below for an example.)</p>

<p>We are now ready to save the table in LaTeX format using <code class="language-plaintext highlighter-rouge">texsave</code>. We will provide a title, some additional LaTeX code for the header of the table, and a footnote:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">local</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="s2">"Association between automobile price and fuel efficiency"</span>
<span class="kt">local</span><span class="w"> </span><span class="n">headerlines</span><span class="w"> </span><span class="s2">"&amp; \multicolumn{2}{c}{Domestic cars} &amp; \multicolumn{2}{c}{Foreign cars} "</span><span class="w"> </span><span class="s2">"\cmidrule(lr){2-3} \cmidrule(lr){4-5}"</span>
<span class="kt">local</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="s2">"Notes: Outcome variable is price (1978 dollars). Columns (1) and (2) report estimates of \(\beta\) from equation (\ref{eqn:model}) for domestic automobiles. Columns (3) and (4) report estimates for foreign automobiles. Robust standard errors are reported in parentheses. A */**/*** indicates significance at the 10/5/1\% levels."</span>
<span class="n">texsave</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="s2">"$MyProject/results/tables/my_regressions.tex"</span><span class="p">,</span><span class="w"> </span><span class="n">autonumber</span><span class="w"> </span><span class="n">varlabels</span><span class="w"> </span><span class="n">hlines</span><span class="p">(</span><span class="m">-2</span><span class="p">)</span><span class="w"> </span><span class="n">nofix</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">marker</span><span class="p">(</span><span class="n">tab</span><span class="o">:</span><span class="n">my_regressions</span><span class="p">)</span><span class="w"> </span><span class="n">title</span><span class="p">(</span><span class="s2">"`title'"</span><span class="p">)</span><span class="w"> </span><span class="n">headerlines</span><span class="p">(</span><span class="s2">"`headerlines'"</span><span class="p">)</span><span class="w"> </span><span class="n">footnote</span><span class="p">(</span><span class="s2">"`fn'"</span><span class="p">)</span>
</code></pre></div></div>

<p>Finally, we can copy the output file, <strong>my_regressions.tex</strong>, to <strong>paper/tables/</strong> and then link to it from our LaTeX <a href="https://github.com/reifjulian/my-project/blob/master/paper/my_paper.tex">manuscript</a> using the LaTeX code <code class="language-plaintext highlighter-rouge">\input{tables/my_regressions.tex}</code>. After compiling the manuscript, our table looks like this:</p>

<p><img src="../assets/guide/table_pdf.PNG" width="100%" title="PDF LaTeX table" /></p>

<h1 id="submission-checklist">Submission checklist</h1>

<p>You’ve completed your analysis, written up your results, and are ready to submit to a journal! Before doing so, ensure that all your numbers are reproducible. If there are any mistakes in the code, it’s better to catch them now rather than later! Follow these steps to replicate your analysis:</p>

<ol>
  <li>
    <p>Make a copy of the <strong>analysis/</strong> folder. For the remaining steps below, work only with this copy. It will become your “replication package.”</p>
  </li>
  <li>
    <p>Rerun your analysis from scratch:</p>

    <ul>
      <li>
        <p>Delete the <strong>processed/</strong> and <strong>results/</strong> folders.</p>
      </li>
      <li>
        <p>Execute <strong>run.do</strong> to regenerate all tables and figures using just the raw data.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Confirm that the reproduced output in <strong>results/figures/</strong> and <strong>results/tables/</strong> matches the results reported in your manuscript.</p>
  </li>
  <li>
    <p>Remove <strong>_install_stata_packages.do</strong> from <strong>scripts/</strong>.</p>
  </li>
  <li>
    <p>Include a license. You can use the AEA’s <a href="https://aeadataeditor.github.io/aea-de-guidance/LICENSE-template.html">mixed license template</a>, which covers both your code and your data. After downloading the license, edit the line <code class="language-plaintext highlighter-rouge">COPYRIGHT &lt;YEAR&gt; &lt;COPYRIGHT HOLDER&gt;</code> to reflect the year and the authors. See the <a href="https://aeadataeditor.github.io/aea-de-guidance/FAQ.html#licensing">AEA Data Editor website</a> for additional discussion.</p>
  </li>
  <li>Add a <a href="https://github.com/reifjulian/my-project/blob/master/analysis/README.pdf">README file</a>. The AEA provides a number of <a href="https://zenodo.org/record/4319999#.YZYla5DML0o">templates</a> in different formats. A minimal README should include the following information:
    <ul>
      <li>Title and authors of the paper</li>
      <li>Required software, including version numbers</li>
      <li>Clear instructions on how to run the analysis</li>
      <li>Description of the raw data and where it is stored</li>
      <li>Explanations for missing data (e.g., data are confidential or proprietary) and how to obtain them</li>
      <li>Description of each script</li>
      <li>Description of where the output is stored</li>
    </ul>
  </li>
  <li>(Optional) Upload to a secure data archive.
    <ul>
      <li>The <a href="https://www.icpsr.umich.edu/icpsrweb/content/ICPSR/access/restricted/enclave.html">ICPSR data enclave</a> is one option.</li>
    </ul>
  </li>
</ol>

<p class="notice--info"><strong>Tip:</strong> Step 3–confirming output–can be tedious. Including <code class="language-plaintext highlighter-rouge">assert</code> statements in Stata, or <code class="language-plaintext highlighter-rouge">stopifnot()</code> statements in R, makes checking output easier. For example, if the main result of your study is a regression estimate of $1.2 million, include an assertion in your code that will fail should this number change following a new data update. Stata examples are available in this <a href="https://github.com/reifjulian/my-project/blob/master/analysis/scripts/4_make_tables_figures.do">sample script</a>.</p>

<h1 id="stata-coding-tips">Stata coding tips</h1>

<ul>
  <li>
    <p>Use forward slashes for pathnames (<code class="language-plaintext highlighter-rouge">$DROPBOX/project</code> not <code class="language-plaintext highlighter-rouge">$DROPBOX\project</code>). Backslashes are an escape character in Stata and can cause problems depending on what operating system you are running. Using forward slashes ensures cross-platform compatibility.</p>
  </li>
  <li>
    <p>Never use hard-coded paths like <strong>C:/Users/jreif/Dropbox/my-project</strong>. All pathnames should reference a global variable defined either in your Stata profile or in your <a href="https://github.com/reifjulian/my-project/blob/master/analysis/run.do">master script</a>. Anyone should be able to run your entire analysis from their computer without having to edit any scripts, with the exception of defining a single global variable in <strong>run.do</strong>.</p>
  </li>
  <li>
    <p>Avoid using spaces and capital letters in file and folder names. Case sensitivity varies across different file systems, and spaces create nuisances when working from the command line or with weblinks. (Your files and folders may eventually be made available online!) Using lowercase letters and underscores or hyphens can help prevent these problems.</p>
  </li>
  <li>
    <p>Include <code class="language-plaintext highlighter-rouge">set varabbrev off</code> in your Stata profile.  This helps you avoid mistakes such as accidently <a href="https://ifs.org.uk/sites/default/files/output_url_files/stata_gotchasJan2014.pdf">referencing the wrong variable</a>.</p>
  </li>
  <li>
    <p>When working with large datasets, use Mauricio Bravo’s <a href="https://github.com/mcaceresb/stata-gtools">gtools</a> and Sergio Correia’s <a href="http://scorreia.com/software/reghdfe/">reghdfe</a>.</p>
  </li>
  <li>
    <p>Rewrite your code frequently and make it readable. Provide helpful comments in the code and make your variable names meaningful (but short). Provide more detailed descriptions using the <code class="language-plaintext highlighter-rouge">label variable</code> command. Always include units in the label.</p>
  </li>
  <li>
    <p>Sometimes an analysis may inexplicably produce different results despite no changes to the code. Here are two common reasons why this happens:</p>
    <ol>
      <li>One of your commands requires random numbers and you forgot to use <code class="language-plaintext highlighter-rouge">set seed #</code></li>
      <li>You have a nonunique sort. Add <code class="language-plaintext highlighter-rouge">isid</code> checks to your code prior to sorting to ensure uniqueness. (Another option is to add the <code class="language-plaintext highlighter-rouge">stable</code> option to your sorts.) Nonunique sorts can be hard to spot:</li>
    </ol>
  </li>
</ul>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">* Stata's default type is float</span>
<span class="c1">* With N=100,000 a randomly generated float may not be unique</span>
<span class="c1">* isid produces error unless you set Stata's default type to double</span>
<span class="k">clear</span>
<span class="k">set</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="m">100</span>
<span class="k">set</span><span class="w"> </span><span class="n">obs</span><span class="w"> </span><span class="m">100000</span>
<span class="k">gen</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">uniform</span><span class="p">()</span>
<span class="k">isid</span><span class="w"> </span><span class="n">r</span>

<span class="c1">* Cast r as a double to avoid this problem</span>
<span class="k">clear</span>
<span class="k">set</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="m">100</span>
<span class="k">set</span><span class="w"> </span><span class="n">obs</span><span class="w"> </span><span class="m">100000</span>
<span class="k">gen</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">uniform</span><span class="p">()</span>
<span class="k">isid</span><span class="w"> </span><span class="n">r</span>
</code></pre></div></div>

<h1 id="other-helpful-links">Other helpful links</h1>

<p><a href="https://medium.com/the-stata-guide/the-stata-to-latex-guide-6e7ed5622856">Asjad Naqvi’s Stata-to-LaTeX guide</a></p>

<p><a href="https://aeadataeditor.github.io/aea-de-guidance/">AEA Data Editor’s guide</a></p>
<ul>
  <li>Additional guidance at the <a href="https://social-science-data-editors.github.io/guidance/">Social Science Data Editors site</a></li>
</ul>

<p><a href="http://www.danielmsullivan.com/pages/tutorial_workflow_3bestpractice.html">Dan Sullivan’s best practices for coding</a></p>

<p><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Gentzkow and Shapiro coding guide</a></p>

<p><a href="https://github.com/uo-ec607/lectures">Grant McDermott’s data science lectures</a></p>

<p><a href="https://zenodo.org/record/3735536#.XopGfqhKguU">Lars Vilhuber’s presentation on transparency and reproducibility</a></p>

<p><a href="https://povertyaction.github.io/guides/cleaning/readme/">Poverty Action Stata Data and Coding Guide</a></p>

<p><a href="http://www.econ.uiuc.edu/~roger/research/repro">Roger Koenker’s guide on reproducibility</a></p>

<p><a href="https://github.com/skhiggins/Stata_guide">Sean Higgin’s Stata guide</a></p>

<h1 id="acknowledgments">Acknowledgments</h1>

<p>The coding practices outlined in this guide have been developed over many years. I would especially like to thank my frequent collaborators Tatyana Deryugina and David Molitor for providing many helpful suggestions that have improved my project organization. I also thank Grant McDermott for several helpful conversations regarding version control and reproducibility in R.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

	<!--
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
	-->
	
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Julian Reif. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









  </body>
</html>
